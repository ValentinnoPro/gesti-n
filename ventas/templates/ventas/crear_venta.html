{% extends "base.html" %}
{% block content %}
<div class="container mt-4" style="max-width: 700px;">
    <h3 class="mb-3">Registrar Nueva Venta</h3>

    <!--  Filtros -->
    <form method="get" class="mb-3">
        <div class="row g-2">
            <div class="col">
                <input type="text" name="buscar_cliente" class="form-control form-control-sm" placeholder="Buscar cliente..." value="{{ cliente_query }}">
            </div>
            <div class="col">
                <input type="text" name="buscar_producto" class="form-control form-control-sm" placeholder="Buscar producto..." value="{{ producto_query }}">
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-sm btn-outline-primary">Buscar</button>
                <a href="{% url 'crear_venta' %}" class="btn btn-sm btn-outline-secondary">Limpiar</a>
            </div>
        </div>
    </form>

    <!-- Mensajes de error -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-sm mt-2 text-center">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Formulario de venta -->
    <form method="post" class="border rounded p-3 shadow-sm bg-light">
        {% csrf_token %}

        <!-- Cliente -->
        <div class="mb-3">
            <label for="cliente" class="form-label small">Cliente:</label>
            <select name="cliente" id="cliente" class="form-select form-select-sm" required>
                {% for cliente in clientes %}
                    <option value="{{ cliente.id }}" {% if cliente.id|stringformat:"s" == cliente_seleccionado %}selected{% endif %}>
                        {{ cliente.nombre }} {{ cliente.apellido }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Productos -->
        <h5 class="mt-3 mb-2">Productos:</h5>
        {% for producto in productos %}
            <div class="mb-3 border rounded p-2 bg-white">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="productos" id="producto_{{ producto.id }}" value="{{ producto.id }}"
                        {% if producto.id|stringformat:"s" in productos_seleccionados %}checked{% endif %}>
                    <label class="form-check-label small" for="producto_{{ producto.id }}">
                        {{ producto.nombre }} - ${{ producto.precio }} (Stock: {{ producto.stock }})
                    </label>
                </div>

                <input type="number" name="cantidad_{{ producto.id }}" id="cantidad_{{ producto.id }}"
                       class="form-control form-control-sm mt-1"
                       min="1" placeholder="Cantidad">
            </div>
        {% empty %}
            <p class="text-muted">No hay productos para mostrar.</p>
        {% endfor %}

        <!-- Botones -->
        <div class="d-flex justify-content-between mt-3">
            <a href="{% url 'lista_ventas' %}" class="btn btn-sm btn-secondary">Cancelar</a>
            <button type="submit" class="btn btn-sm btn-primary">Registrar Venta</button>
        </div>
    </form>
</div>
{% endblock %}
